
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Planificando la descarga de informes de iTunes Connect - Javi Moreno</title>
  <meta name="author" content="Javi Moreno">

  
  <meta name="description" content="Hace poco me puse con una tarea que tenía pendiente desde el verano: automatizar la descarga de informes del iTunes Connect. El 30 de Agosto, en el &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://javimoreno.me/blog/2011/12/03/planificando-la-descarga-de-informes-de-itunes-connect">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Javi Moreno" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Asap:400,700,700italic,400italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
<link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
<link rel="apple-touch-icon" href="apple-touch-icon.png" />
<link rel="apple-touch-icon" sizes="72x72" href="apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon" sizes="114x114" href="apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon" sizes="144x144" href="apple-touch-icon-144x144.png" />
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-38448478-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Javi Moreno</a></h1>
  
    <h2>&#9823;</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<ul class="social">

  <li><a rel="twitter" href="http://twitter.com/jmoreno78" title="Twitter">Twitter</a></li>


  <li><a rel="github" href="https://github.com/jmoreno" title="GitHub">GitHub</a></li>


  <li><a rel="email" href="mailto:javi@javimoreno.me" title="Email">Email</a></li>

</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:javimoreno.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/sobre-mi">Sobre mi</a></li>
  <li><a href="/proyectos">Proyectos</a></li>
  <li><a href="http://www.zinkinapps.com">Zink in apps!</a></li>
  <li><a href="/blog/archives">Archivo</a></li>
</ul>
</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
		
			
		    <h1 class="entry-title">Planificando la descarga de informes de iTunes Connect</h1>
			
		
    
      <p class="meta">
        








  


<time datetime="2011-12-03T16:46:00+00:00" pubdate data-updated="true">Dec 3<span>rd</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Hace poco me puse con una tarea que tenía pendiente desde el verano: automatizar la descarga de informes del iTunes Connect.</p>

<p>El 30 de Agosto, en el Apple Developer Connection (en el iOS Developer News también) publicaron esto: <a href="http://developer.apple.com/news/index.php?id=08302011a">Automatically Download iTunes Connect Reports</a>.
Lo que nos contaban ahí es que habían desarrollado una nueva herramienta para poder descargar los informes de ventas del iTunes Connect sin tener que acceder a dicho portal.
Esto está muy bien, primero porque la descarga de varios informes es bastante tediosa, segundo porque es normal que no te acuerdes de entrar a descargarlos y puedes automatizar la descarga y tercero porque las herramientas para el seguimiento de las ventas brillan por su ausencia así que si empiezan a hacer alguna es una buena señal.</p>

<!-- more -->


<p>A los cuatro días ya podía encontrarse en la web este enlace: <a href="http://ipaddevzone.com/cs/bash-script-download-all-available-reports-using-apples-auto-ingest-tool-itunes-connect-sales-tren">A Bash script to download all available reports using Apple&#8217;s ‘Auto-Ingest’ Tool for iTunes Connect Sales &amp; Trends Reports</a></p>

<p>Voy a insistir un poco más en la importancia de la planificación de estas descargas: tanto con esta herramienta como desde el portal solo puedes descargarte los últimos 14 informes diarios y los últimos 13 informes semanales (de ventas, no los que echan en la primera de TVE los sábados por la noche). Si planificas una tarea de descarga diaria, mal se tiene que dar para que al menos una vez en 14 días tu Mac no esté encendido a la/s hora/s planificada/s.
En el enlace de iPad DevZone nos mostraban un Bash script para ejecutar la descarga, con comprobación de existencia de fichero descargado para no repetir además de los pasos a seguir para planificar este script correctamente.</p>

<p>Lo que escribo a continuación es, básicamente, la traducción del contenido de ese post con alguna aclaración más para los que no tengan ni idea de lo que es un script bash ni de como se planifica (yo era uno de esos hasta hace quince días).</p>

<p>1.- Creamos un directorio para nuestros scripts, por ejemplo: ~/bin/itc (para los no familiarizados con esta notación esto es crear una carpeta que se llame &#8220;bin&#8221; dentro de nuestra carpeta de usuario que, a su vez, contenga otra carpeta llamada &#8220;itc&#8221;)</p>

<p>2.- Con nuestro editor de texto favorito (yo lo hice con TextWrangler) creamos un archivo llamado &#8220;download_itc_reports_sh&#8221; y lo guardamos en la carpeta &#8220;itc&#8221; que hemos creado antes. A continuación copiamos uno de los scripts que están al final de este post, lo pegamos y modificamos los parámetros de la sección de &#8220;Configuration&#8221; con nuestros propios datos.
USER_NAME es nuestro usuario de acceso al iTC, USER_PASSWD la contraseña, VENDOR_ID el código de compañía y DIR_DEST el directorio donde vamos a descargar los informes. En mi caso particular, el directorio de descarga está dentro de la carpeta de DropBox que tengo en el Mac y así tengo el backup de los informes automatizado&#8230; ;-)</p>

<p>3.- En la misma carpeta donde dejamos este fichero, tenemos que tener la herramienta de descarga automática que no es otra cosa que una clase Java. Si no la has descargado todavía puedes hacerlo desde este <a href="http://www.apple.com/itunesnews/docs/Autoingestion.class.zip">enlace</a>. Tendrás que tener Java instalado para poder utilizar esta herramienta.
Los siguientes pasos ya hay que darlos en el Terminal.</p>

<p>4.- Si queremos ejecutar manualmente el script, escribimos en el terminal lo siguiente:</p>

<pre><code>$ ~/bin/itc/download_itc_reports.sh
</code></pre>

<p>5.- Para planificarlo tendremos que usar otra herramienta escondida dentro del Terminal: Crontab</p>

<p>6.- Para editar las entradas de Crontab escribimos lo siguiente en el terminal:</p>

<pre><code>$ crontab -e
</code></pre>

<p>7.- En una nueva linea en blanco (o en la primera si no tenemos nada) escribimos lo siguiente</p>

<pre><code>0 13,14,16 * * * ~/bin/itc/download_itc_reports.sh
</code></pre>

<p>8.- Breve explicación sobre crontab. Cada registro consta de seis argumentos: minutos, horas, día del mes, mes, día de la semana y comando a ejecutar. Varios valores para el mismo argumento se separan por comas. El ejemplo se entiende como: &#8220;en el minuto cero de las 13, 14 y 16 horas de cualquier día, de cualquier mes y cualquier día de la semana ejecutar el comando ~/bin/itc/download_itc_reports.sh. Puedes encontrar más información de crontab en este <a href="http://benr75.com/pages/using_crontab_mac_os_x_unix_linux">enlace</a>.</p>

<p>9.- Si ya hemos creado otro script (por ejemplo: uno para informes diarios y otro para los semanales) habría que incluir otra linea con la planificación deseada y el nombre del script.</p>

<p>10.- Una vez que hemos terminado de editar, guardamos y comprobamos nuestro trabajo escribiendo en el terminal:</p>

<pre><code>$ crontab -l
</code></pre>

<p>11.- Y ya está, si el Mac está encendido a las horas planificadas se ejecutarán los scripts.</p>

<p>Los informes son ficheros planos que pueden ser importados a cualquier hoja de cálculo o base de datos que nos hayamos creado. Yo uso una aplicación que se llama AppStar Lite que permite importar estos informes y visualizarlos de una forma agradable.</p>

<p>Actualmente podemos descargarnos dos tipos de informe: Diarios y Semanales. A continuación hay un script para cada uno.
Además, cada tipo de informe tiene dos subtipos: Summary y Opt-In. No tengo muy clara la diferencia entre los primeros y los segundos. Los scripts están escritos para descargar los Summary, para descargar los Opt-In simplemente habría que cambiar una palabra por la otra.</p>

<p>Script para descarga de informes diarios:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/usr/bin/env bash</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># Copyright 2011, Shark Intelligence, s.r.o.</span>
</span><span class='line'><span class="c"># Released under the MIT license</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c">#-------------------------------------------------------------------------------</span>
</span><span class='line'><span class="c"># Configuration</span>
</span><span class='line'><span class="c">#-------------------------------------------------------------------------------</span>
</span><span class='line'><span class="c"># ITC user name</span>
</span><span class='line'><span class="nv">USER_NAME</span><span class="o">=</span><span class="s2">&quot;user name&quot;</span>
</span><span class='line'><span class="c"># ITC user password</span>
</span><span class='line'><span class="nv">USER_PASSWD</span><span class="o">=</span><span class="s2">&quot;user password&quot;</span>
</span><span class='line'><span class="c"># vendorid: find it at: https://reportingitc.apple.com/subdashboard.faces</span>
</span><span class='line'><span class="nv">VENDOR_ID</span><span class="o">=</span><span class="s2">&quot;vendor Id&quot;</span>
</span><span class='line'><span class="c"># directory where the reports are downloaded; Current dir is used if empty;</span>
</span><span class='line'><span class="nv">DIR_DEST</span><span class="o">=</span>~/projects/XXX/reports-sales
</span><span class='line'><span class="c"># number of days beginning with yesterday which the reports are downloaded for</span>
</span><span class='line'><span class="nv">NUM_OF_DAYS_TO_DOWNLOAD</span><span class="o">=</span>14
</span><span class='line'><span class="c"># Currently only Sales reports are supported</span>
</span><span class='line'><span class="nv">REPORT_TYPE</span><span class="o">=</span><span class="s2">&quot;S&quot;</span>
</span><span class='line'><span class="c"># Currently only Daily report frequency is supported</span>
</span><span class='line'><span class="nv">REPORT_FREQ</span><span class="o">=</span><span class="s2">&quot;D&quot;</span>
</span><span class='line'><span class="c">#-------------------------------------------------------------------------------</span>
</span><span class='line'><span class="c"># Program start</span>
</span><span class='line'><span class="c">#-------------------------------------------------------------------------------</span>
</span><span class='line'><span class="c"># Adjust input vars</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$DIR_DEST&quot;</span> <span class="o">]</span>; <span class="k">then </span><span class="nv">DIR_DEST</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span> -P<span class="sb">`</span>; <span class="k">fi</span>
</span><span class='line'><span class="c"># Print info</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nb">echo </span>Downloading ITC sales reports <span class="k">for</span> <span class="nv">$NUM_OF_DAYS_TO_DOWNLOAD</span> days into destination: <span class="nv">$DIR_DEST</span>
</span><span class='line'><span class="c"># set CLASSPATH which should point the this script location</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nv">THIS_SCRIPT</span><span class="o">=</span><span class="nv">$0</span>
</span><span class='line'><span class="nb">cd</span> <span class="sb">`</span>dirname <span class="nv">$THIS_SCRIPT</span><span class="sb">`</span>
</span><span class='line'><span class="nv">CLASSPATH</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span> -P<span class="sb">`</span>
</span><span class='line'><span class="c"># set dir where the reports are downloaded to</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nb">cd</span> <span class="nv">$DIR_DEST</span>
</span><span class='line'><span class="c"># loop for requested NUM_OF_DAYS_TO_DOWNLOAD</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="k">for</span> <span class="o">((</span> <span class="nv">DAY</span><span class="o">=</span>NUM_OF_DAYS_TO_DOWNLOAD; DAY&gt;0; DAY-- <span class="o">))</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'><span class="nv">DT_CUR_STR</span><span class="o">=</span><span class="s2">&quot;date -v-${DAY}d +%Y%m%d&quot;</span>
</span><span class='line'><span class="nv">DT_CUR</span><span class="o">=</span><span class="sb">`</span><span class="nv">$DT_CUR_STR</span><span class="sb">`</span>
</span><span class='line'><span class="nv">FILE_CUR</span><span class="o">=</span><span class="s2">&quot;${REPORT_TYPE}_${REPORT_FREQ}_${VENDOR_ID}_${DT_CUR}.txt.gz&quot;</span>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> <span class="k">$(</span>find . -name <span class="nv">$FILE_CUR</span> -maxdepth 1 -type f | wc -l<span class="k">)</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span> <span class="o">]</span>
</span><span class='line'><span class="k">then</span>
</span><span class='line'><span class="c"># Report is missing so download one</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nb">echo</span> <span class="nv">$DT_CUR</span>: MISSING! Download initiated...
</span><span class='line'>java -cp <span class="nv">$CLASSPATH</span> Autoingestion <span class="nv">$USER_NAME</span> <span class="nv">$USER_PASSWD</span> <span class="nv">$VENDOR_ID</span> Sales Daily Summary <span class="nv">$DT_CUR</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="c"># Report is found</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;$DT_CUR: already here&quot;</span>
</span><span class='line'><span class="k">fi</span>
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<p>Script para descarga de informes semanales:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/usr/bin/env bash</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># Copyright 2011, Shark Intelligence, s.r.o.</span>
</span><span class='line'><span class="c"># Released under the MIT license</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c">#-------------------------------------------------------------------------------</span>
</span><span class='line'><span class="c"># Configuration</span>
</span><span class='line'><span class="c">#-------------------------------------------------------------------------------</span>
</span><span class='line'><span class="c"># ITC user name</span>
</span><span class='line'><span class="nv">USER_NAME</span><span class="o">=</span><span class="s2">&quot;user name&quot;</span>
</span><span class='line'><span class="c"># ITC user password</span>
</span><span class='line'><span class="nv">USER_PASSWD</span><span class="o">=</span><span class="s2">&quot;user password&quot;</span>
</span><span class='line'><span class="c"># vendorid: find it at: https://reportingitc.apple.com/subdashboard.faces</span>
</span><span class='line'><span class="nv">VENDOR_ID</span><span class="o">=</span><span class="s2">&quot;vendor Id&quot;</span>
</span><span class='line'><span class="c"># directory where the reports are downloaded; Current dir is used if empty;</span>
</span><span class='line'><span class="nv">DIR_DEST</span><span class="o">=</span>~/projects/XXX/reports-sales
</span><span class='line'><span class="c"># number of days beginning with yesterday which the reports are downloaded for</span>
</span><span class='line'><span class="nv">NUM_OF_WEEKS_TO_DOWNLOAD</span><span class="o">=</span>13
</span><span class='line'><span class="c"># Currently only Sales reports are supported</span>
</span><span class='line'><span class="nv">REPORT_TYPE</span><span class="o">=</span><span class="s2">&quot;S&quot;</span>
</span><span class='line'><span class="c"># Currently only Daily report frequency is supported</span>
</span><span class='line'><span class="nv">REPORT_FREQ</span><span class="o">=</span><span class="s2">&quot;W&quot;</span>
</span><span class='line'><span class="c">#-------------------------------------------------------------------------------</span>
</span><span class='line'><span class="c"># Program start</span>
</span><span class='line'><span class="c">#-------------------------------------------------------------------------------</span>
</span><span class='line'><span class="c"># Adjust input vars</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$DIR_DEST&quot;</span> <span class="o">]</span>; <span class="k">then </span><span class="nv">DIR_DEST</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span> -P<span class="sb">`</span>; <span class="k">fi</span>
</span><span class='line'><span class="c"># Print info</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nb">echo </span>Downloading ITC sales reports <span class="k">for</span> <span class="nv">$NUM_OF_WEEKS_TO_DOWNLOAD</span> days into destination: <span class="nv">$DIR_DEST</span>
</span><span class='line'><span class="c"># set CLASSPATH which should point the this script location</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nv">THIS_SCRIPT</span><span class="o">=</span><span class="nv">$0</span>
</span><span class='line'><span class="nb">cd</span> <span class="sb">`</span>dirname <span class="nv">$THIS_SCRIPT</span><span class="sb">`</span>
</span><span class='line'><span class="nv">CLASSPATH</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span> -P<span class="sb">`</span>
</span><span class='line'><span class="c"># set dir where the reports are downloaded to</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nb">cd</span> <span class="nv">$DIR_DEST</span>
</span><span class='line'><span class="c"># loop for requested NUM_OF_WEEKS_TO_DOWNLOAD</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="k">for</span> <span class="o">((</span> <span class="nv">WEEK</span><span class="o">=</span>NUM_OF_WEEKS_TO_DOWNLOAD; WEEK&gt;0; WEEK-- <span class="o">))</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'><span class="c"># set value for last sunday</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nv">DT_DAY_OF_WEEK</span><span class="o">=</span><span class="sb">`</span>date +%w<span class="sb">`</span>
</span><span class='line'><span class="nb">let </span><span class="nv">DAYS</span><span class="o">=(</span>WEEK-1<span class="o">)</span>*7+DT_DAY_OF_WEEK
</span><span class='line'><span class="nv">DT_CUR_STR</span><span class="o">=</span><span class="s2">&quot;date -v-${DAY}d +%Y%m%d&quot;</span>
</span><span class='line'><span class="nv">DT_CUR</span><span class="o">=</span><span class="sb">`</span><span class="nv">$DT_CUR_STR</span><span class="sb">`</span>
</span><span class='line'><span class="nv">FILE_CUR</span><span class="o">=</span><span class="s2">&quot;${REPORT_TYPE}_${REPORT_FREQ}_${VENDOR_ID}_${DT_CUR}.txt.gz&quot;</span>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> <span class="k">$(</span>find . -name <span class="nv">$FILE_CUR</span> -maxdepth 1 -type f | wc -l<span class="k">)</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span> <span class="o">]</span>
</span><span class='line'><span class="k">then</span>
</span><span class='line'><span class="c"># Report is missing so download one</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nb">echo</span> <span class="nv">$DT_CUR</span>: MISSING! Download initiated...
</span><span class='line'>java -cp <span class="nv">$CLASSPATH</span> Autoingestion <span class="nv">$USER_NAME</span> <span class="nv">$USER_PASSWD</span> <span class="nv">$VENDOR_ID</span> Sales Daily Summary <span class="nv">$DT_CUR</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="c"># Report is found</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;$DT_CUR: already here&quot;</span>
</span><span class='line'><span class="k">fi</span>
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>



</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Javi Moreno</span></span>

      








  


<time datetime="2011-12-03T16:46:00+00:00" pubdate data-updated="true">Dec 3<span>rd</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/análisis/'>Análisis</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <div class="kcy_karmacracy_widget_h_ID" style="display:inline"></div>
  
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://javimoreno.me/blog/2011/12/03/planificando-la-descarga-de-informes-de-itunes-connect/" data-via="jmoreno78" data-counturl="http://javimoreno.me/blog/2011/12/03/planificando-la-descarga-de-informes-de-itunes-connect/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/10/26/5/" title="Previous Post: No empezamos muy bien... es difícil sacar tiempo para escribir un blog. ">&laquo; No empezamos muy bien... es difícil sacar tiempo para escribir un blog. </a>
      
      
        <a class="basic-alignment right" href="/blog/2012/01/12/cursores-dinamicos-y-nscompoundpredicate/" title="Next Post: Cursores dinámicos y NSCompoundPredicate">Cursores dinámicos y NSCompoundPredicate &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>


</div>

<aside class="sidebar">
  
    
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Javi Moreno -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'eloctoblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://javimoreno.me/blog/2011/12/03/planificando-la-descarga-de-informes-de-itunes-connect/';
        var disqus_url = 'http://javimoreno.me/blog/2011/12/03/planificando-la-descarga-de-informes-de-itunes-connect/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


  
  <script defer="defer" src="http://rodney.karmacracy.com/widget-3.0/?id=ID&button=1&display=right&show-tooltip=0"></script>
  




</body>
</html>
